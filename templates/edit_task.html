<!DOCTYPE html>
<html>
<head>
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ñ–µ</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</h1>
    
   <form action="/update_task/{{ task[0] }}" method="POST">
        <p>
            <label>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</label><br>
            <input type="time" name="task_time" value="{{ task[1] }}" required>
        </p>
        <p>
            <label>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:</label><br>
            <textarea name="task_text" rows="3" cols="50" required>{{ task[2] }}</textarea>
        </p>
        <p>
            <label>–ù–∞–∑–Ω–∞—á–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label><br>
            <input type="text" name="assigned_to" id="assigned_to" value="{% if task[8] %}{{ task[8] }}{% endif %}" placeholder="@username –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö" autocomplete="off">
            <div id="suggestions" style="display: none; position: absolute; background: white; border: 1px solid #ccc; max-height: 150px; overflow-y: auto; z-index: 1000;"></div>
            <small style="color: #666;">üí° –£–∫–∞–∂–∏—Ç–µ @username –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏</small>
        </p>
        <p>
            <label>–¢–∏–ø –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:</label><br>
            <input type="radio" name="repeat_type" value="once" {% if task[4] == 0 and task[6] == 0 %}checked{% endif %}> üìÖ –†–∞–∑–æ–≤–∞—è –∑–∞–¥–∞—á–∞<br>
            <input type="radio" name="repeat_type" value="daily" {% if task[4] == 1 %}checked{% endif %}> üîÑ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ<br>
            <input type="radio" name="repeat_type" value="weekly" {% if task[6] == 1 %}checked{% endif %}> üìÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
        </p>
        <p id="week_day_select" {% if task[6] == 0 %}style="display: none;"{% endif %}>
            <label>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</label><br>
            <select name="week_day">
                <option value="0" {% if task[7] == 0 %}selected{% endif %}>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                <option value="1" {% if task[7] == 1 %}selected{% endif %}>–í—Ç–æ—Ä–Ω–∏–∫</option>
                <option value="2" {% if task[7] == 2 %}selected{% endif %}>–°—Ä–µ–¥–∞</option>
                <option value="3" {% if task[7] == 3 %}selected{% endif %}>–ß–µ—Ç–≤–µ—Ä–≥</option>
                <option value="4" {% if task[7] == 4 %}selected{% endif %}>–ü—è—Ç–Ω–∏—Ü–∞</option>
                <option value="5" {% if task[7] == 5 %}selected{% endif %}>–°—É–±–±–æ—Ç–∞</option>
                <option value="6" {% if task[7] == 6 %}selected{% endif %}>–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
            </select>
        </p>
        <p>
            <label>
                <input type="checkbox" name="require_photo" value="1" {% if task[5] == 1 %}checked{% endif %}>
                üì∏ –¢—Ä–µ–±—É–µ—Ç —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç (—á–µ—Ä–µ–∑ 5 –º–∏–Ω –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
            </label>
        </p>
        <p>
            <input type="submit" value="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è">
            <a href="/">–û—Ç–º–µ–Ω–∞</a>
        </p>
    </form>
    
    <script>
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –¥–Ω—è –Ω–µ–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
        document.querySelectorAll('input[name="repeat_type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const weekDaySelect = document.getElementById('week_day_select');
                if (this.value === 'weekly') {
                    weekDaySelect.style.display = 'block';
                } else {
                    weekDaySelect.style.display = 'none';
                }
            });
        });
    </script>
    <script>
    const assignedInput = document.getElementById('assigned_to');
    const suggestionsDiv = document.getElementById('suggestions');
    const usernames = [
        {% if used_usernames %}
            {% for nickname in used_usernames %}
            "{{ nickname }}",
            {% endfor %}
        {% endif %}
    ];

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –Ω–∏–∫–Ω–µ–π–º—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª–µ
    assignedInput.addEventListener('focus', function() {
        if (usernames.length > 0) {
            suggestionsDiv.innerHTML = usernames.map(name => 
                `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
            ).join('');
            suggestionsDiv.style.display = 'block';
        }
    });

    assignedInput.addEventListener('click', function() {
        if (usernames.length > 0) {
            suggestionsDiv.innerHTML = usernames.map(name => 
                `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
            ).join('');
            suggestionsDiv.style.display = 'block';
        }
    });

    assignedInput.addEventListener('input', function() {
        const value = this.value.toLowerCase();
        const filtered = usernames.filter(name => name.toLowerCase().includes(value));
        
        if (value.length > 0 && filtered.length > 0) {
            suggestionsDiv.innerHTML = filtered.map(name => 
                `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
            ).join('');
            suggestionsDiv.style.display = 'block';
        } else {
            suggestionsDiv.style.display = 'none';
        }
    });

    function selectUsername(name) {
        assignedInput.value = name;
        suggestionsDiv.style.display = 'none';
    }

    document.addEventListener('click', function(e) {
        if (!assignedInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
            suggestionsDiv.style.display = 'none';
        }
    });
    </script>
</body>
</html>