<!DOCTYPE html>
<html>
<head>
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ñ–µ</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ username }}!</p>

    <h2>üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>

    <!-- –ë–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
    <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #dee2e6;">
        <h4>üîç –§–∏–ª—å—Ç—Ä—ã:</h4>
        <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
            
            <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ -->
            <div>
                <label><strong>–ü–æ –¥–∞—Ç–µ:</strong></label><br>
                <select id="dateFilter" onchange="applyFilters()">
                    <option value="all">–í—Å–µ</option>
                    <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                    <option value="daily">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ</option>
                    <option value="week">7 –¥–Ω–µ–π</option>
                </select>
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é -->
            <div>
                <label><strong>–ü–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é:</strong></label><br>
                <select id="executorFilter" onchange="applyFilters()">
                    <option value="all">–í—Å–µ</option>
                    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è JS -->
                </select>
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É -->
            <div>
                <label><strong>–ü–æ —Ç–∏–ø—É:</strong></label><br>
                <select id="typeFilter" onchange="applyFilters()">
                    <option value="all">–í—Å–µ</option>
                    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è JS -->
                </select>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ -->
            <div>
                <br>
                <button onclick="resetFilters()" style="padding: 5px 10px;">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <!-- –ö–Ω–æ–ø–∫–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á -->
    <div style="margin: 10px 0;">
        <button onclick="deleteSelectedActive()" style="background: #dc3545; color: white; padding: 8px 15px; border: none; border-radius: 3px; cursor: pointer;">
            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
        </button>
        <span id="activeSelectedCount" style="margin-left: 10px; color: #666;"></span>
    </div>
    {% if active_tasks %}
        <table id="activeTasks" border="1" style="border-collapse: collapse; width: 100%;">
        <tr>
            <th>
                <input type="checkbox" id="selectAllActive" onchange="toggleAllActive()"> –í—Å–µ
            </th>
            <th>–í—Ä–µ–º—è</th>
            <th>–î–∞—Ç–∞</th>
            <th>–ó–∞–¥–∞—á–∞</th>
            <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>
            <th>–¢–∏–ø</th>
            <th>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
            {% for task in active_tasks %}
            <tr>
                <td>
                    <input type="checkbox" class="task-checkbox-active" value="{{ task[0] }}">
                </td>
                <td>{{ task[1] }}</td>
                <td>
                    {% if task[4] == 1 %}
                        –ï–∂–µ–¥–Ω–µ–≤–Ω–æ
                    {% elif task[6] == 1 %}
                        {{ ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'][task[7]] }}
                    {% elif task[10] == 1 %}
                        {{ task[11] }} —á–∏—Å–ª–æ
                    {% elif task[9] %}
                        {{ task[9] }}
                    {% else %}
                        –°–µ–≥–æ–¥–Ω—è
                    {% endif %}
                </td>
                <td>{{ task[2] }}</td>
                <td>{% if task[8] %}{{ task[8] }}{% else %}–î–ª—è –≤—Å–µ—Ö{% endif %}</td>
                <td>
                    {% if task[4] == 1 %}üîÑ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ
                    {% elif task[6] == 1 %}üìÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ ({{ ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'][task[7]] }})
                    {% elif task[10] == 1 %}üóìÔ∏è –ï–∂–µ–º–µ—Å—è—á–Ω–æ ({{ task[11] }} —á–∏—Å–ª–æ)
                    {% else %}üìÖ –†–∞–∑–æ–≤–∞—è{% endif %}
                </td>
                <td>
                    {% if task[5] == 1 %}üì∏ –î–∞{% else %}‚Äî{% endif %}
                    {% if task[12] == 1 %}<br>üë• –ì—Ä—É–ø–ø–æ–≤–∞—è{% endif %}
                </td>
                <td>
                    <a href="/edit_task/{{ task[0] }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a> | 
                    <a href="/delete_task/{{ task[0] }}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</p>
    {% endif %}

    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h2>
    <form action="/add_task" method="POST">
        <p>
            <label>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</label><br>
            <input type="time" name="task_time" required>
        </p>
        <p>
            <label>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:</label><br>
            <textarea name="task_text" rows="3" cols="50" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞—Å—Å—Ç–∞–≤–∏—Ç—å –∑–æ–Ω—Ç—ã" required></textarea>
        </p>
        <p>
            <label>–ù–∞–∑–Ω–∞—á–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label><br>
            <input type="text" name="assigned_to" id="assigned_to" placeholder="@username –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö" autocomplete="off">
            <div id="suggestions" style="display: none; position: absolute; background: white; border: 1px solid #ccc; max-height: 150px; overflow-y: auto; z-index: 1000;"></div>

            <script>
            const assignedInput = document.getElementById('assigned_to');
            const suggestionsDiv = document.getElementById('suggestions');
            const usernames = [
                {% if used_usernames %}
                    {% for nickname in used_usernames %}
                    "{{ nickname }}",
                    {% endfor %}
                {% endif %}
            ];

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –Ω–∏–∫–Ω–µ–π–º—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª–µ
            assignedInput.addEventListener('focus', function() {
                if (usernames.length > 0) {
                    suggestionsDiv.innerHTML = usernames.map(name => 
                        `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
                    ).join('');
                    suggestionsDiv.style.display = 'block';
                }
            });

            assignedInput.addEventListener('click', function() {
                if (usernames.length > 0) {
                    suggestionsDiv.innerHTML = usernames.map(name => 
                        `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
                    ).join('');
                    suggestionsDiv.style.display = 'block';
                }
            });

            assignedInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = usernames.filter(name => name.toLowerCase().includes(value));
                
                if (value.length > 0 && filtered.length > 0) {
                    suggestionsDiv.innerHTML = filtered.map(name => 
                        `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
                    ).join('');
                    suggestionsDiv.style.display = 'block';
                } else {
                    suggestionsDiv.style.display = 'none';
                }
            });

            function selectUsername(name) {
                assignedInput.value = name;
                suggestionsDiv.style.display = 'none';
            }

            document.addEventListener('click', function(e) {
                if (!assignedInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });
            </script>
            <small style="color: #666;">üí° –£–∫–∞–∂–∏—Ç–µ @username –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ–π –∫–æ–º–∞–Ω–¥—ã</small>
        </p>
        <p>
            <label>–¢–∏–ø –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:</label><br>
            <input type="radio" name="repeat_type" value="daily" checked> üîÑ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏<br>
            <input type="radio" name="repeat_type" value="weekly"> üìÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ<br>
            <input type="radio" name="repeat_type" value="monthly"> üóìÔ∏è –ï–∂–µ–º–µ—Å—è—á–Ω–æ<br>
            <input type="radio" name="repeat_type" value="once"> üìÖ –†–∞–∑–æ–≤–∞—è –∑–∞–¥–∞—á–∞ (—Å–µ–≥–æ–¥–Ω—è)<br>
            <input type="radio" name="repeat_type" value="specific"> üóìÔ∏è –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞<br>
        </p>
        <p id="specific_date_select" style="display: none;">
            <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label><br>
            <input type="date" name="task_date" id="task_date">
            <small style="color: #666;">üí° –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–¥—É—â–∏–µ –¥–∞—Ç—ã</small>
        </p>
        <p id="week_day_select" style="display: none;">
            <label>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</label><br>
            <select name="week_day">
                <option value="0">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                <option value="1">–í—Ç–æ—Ä–Ω–∏–∫</option>
                <option value="2">–°—Ä–µ–¥–∞</option>
                <option value="3">–ß–µ—Ç–≤–µ—Ä–≥</option>
                <option value="4">–ü—è—Ç–Ω–∏—Ü–∞</option>
                <option value="5">–°—É–±–±–æ—Ç–∞</option>
                <option value="6">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
            </select>
        </p>
        <p id="month_day_select" style="display: none;">
            <label>–î–µ–Ω—å –º–µ—Å—è—Ü–∞:</label><br>
            <input type="number" name="month_day" min="1" max="31" value="1" style="width: 80px;">
            <small style="color: #666;">üí° –ï—Å–ª–∏ –≤ –º–µ—Å—è—Ü–µ –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –¥–Ω—è, –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞</small>
        </p>
        <p>
            <label>
                <input type="checkbox" name="require_photo" value="1">
                üì∏ –¢—Ä–µ–±—É–µ—Ç —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç (—á–µ—Ä–µ–∑ 5 –º–∏–Ω –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
            </label>
        </p>
        <p>
            <label>
                <input type="checkbox" name="allow_multiple" value="1">
                üë• –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º (–∫–Ω–æ–ø–∫–∞ –∏—Å—á–µ–∑–Ω–µ—Ç —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞)
            </label>
        </p>
        <p>
            <input type="submit" value="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É">
        </p>
    </form>

    <p>
        <a href="/completed_tasks">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</a> | 
        <a href="/reports">üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á—ë—Ç—ã</a> | 
        <a href="/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a> | 
        <a href="/logout">–í—ã–π—Ç–∏</a>
    </p>
    
    <script>
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
            document.querySelectorAll('input[name="repeat_type"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const weekDaySelect = document.getElementById('week_day_select');
                    const monthDaySelect = document.getElementById('month_day_select');
                    const dateSelect = document.getElementById('specific_date_select');
                    
                    if (this.value === 'weekly') {
                        weekDaySelect.style.display = 'block';
                        monthDaySelect.style.display = 'none';
                        dateSelect.style.display = 'none';
                    } else if (this.value === 'monthly') {
                        weekDaySelect.style.display = 'none';
                        monthDaySelect.style.display = 'block';
                        dateSelect.style.display = 'none';
                    } else if (this.value === 'specific') {
                        weekDaySelect.style.display = 'none';
                        monthDaySelect.style.display = 'none';
                        dateSelect.style.display = 'block';
                    } else {
                        weekDaySelect.style.display = 'none';
                        monthDaySelect.style.display = 'none';
                        dateSelect.style.display = 'none';
                    }
                });
            });
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –∏ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    document.addEventListener('DOMContentLoaded', function() {
                        const dateInput = document.getElementById('task_date');
                        const today = new Date().toISOString().split('T')[0];
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É - —Å–µ–≥–æ–¥–Ω—è
                        dateInput.min = today;
                        
                        // –ü—Ä–∏ –≤—ã–±–æ—Ä–µ "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–≤–∏–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
                        document.querySelectorAll('input[name="repeat_type"]').forEach(radio => {
                            radio.addEventListener('change', function() {
                                if (this.value === 'specific' && !dateInput.value) {
                                    dateInput.value = today;
                                }
                            });
                        });
                    });
    </script>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã
        function populateFilters() {
            const table = document.getElementById('activeTasks');
            const rows = table.querySelectorAll('tbody tr, tr:not(:first-child)');
            
            const executors = new Set(['–í—Å–µ']);
            const types = new Set(['–í—Å–µ']);
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 4) {
                    // –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (4-—è –∫–æ–ª–æ–Ω–∫–∞)
                    const executor = cells[3].textContent.trim();
                    if (executor && executor !== '–î–ª—è –≤—Å–µ—Ö') {
                        executors.add(executor);
                    } else {
                        executors.add('–î–ª—è –≤—Å–µ—Ö');
                    }
                    
                    // –¢–∏–ø (5-—è –∫–æ–ª–æ–Ω–∫–∞)
                    const type = cells[4].textContent.trim();
                    if (type) {
                        types.add(type);
                    }
                }
            });
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
            const executorSelect = document.getElementById('executorFilter');
            executorSelect.innerHTML = '<option value="all">–í—Å–µ</option>';
            Array.from(executors).sort().forEach(executor => {
                if (executor !== '–í—Å–µ') {
                    const option = document.createElement('option');
                    option.value = executor;
                    option.textContent = executor;
                    executorSelect.appendChild(option);
                }
            });
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç —Ç–∏–ø–æ–≤
            const typeSelect = document.getElementById('typeFilter');
            typeSelect.innerHTML = '<option value="all">–í—Å–µ</option>';
            Array.from(types).sort().forEach(type => {
                if (type !== '–í—Å–µ') {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    typeSelect.appendChild(option);
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            const dateFilter = document.getElementById('dateFilter').value;
            const executorFilter = document.getElementById('executorFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            
            const table = document.getElementById('activeTasks');
            const rows = table.querySelectorAll('tbody tr, tr:not(:first-child)');
            
            const today = new Date().toISOString().split('T')[0];
            const weekFromNow = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length === 0) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                
                let showRow = true;
                
                // –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
                if (dateFilter !== 'all') {
                    const dateCell = cells[1].textContent.trim();
                    
                    if (dateFilter === 'today' && dateCell !== '–°–µ–≥–æ–¥–Ω—è') {
                        showRow = false;
                    } else if (dateFilter === 'daily' && dateCell !== '–ü–æ—Å—Ç–æ—è–Ω–Ω–æ') {
                        showRow = false;
                    } else if (dateFilter === 'week') {
                        // –î–ª—è –Ω–µ–¥–µ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã
                        if (!dateCell.includes('-') && dateCell !== '–°–µ–≥–æ–¥–Ω—è' && dateCell !== '–ü–æ—Å—Ç–æ—è–Ω–Ω–æ') {
                            showRow = false;
                        }
                    }
                }
                
                // –§–∏–ª—å—Ç—Ä –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é
                if (executorFilter !== 'all' && showRow) {
                    const executorCell = cells[3].textContent.trim();
                    if (executorCell !== executorFilter) {
                        showRow = false;
                    }
                }
                
                // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
                if (typeFilter !== 'all' && showRow) {
                    const typeCell = cells[4].textContent.trim();
                    if (typeCell !== typeFilter) {
                        showRow = false;
                    }
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É
                row.style.display = showRow ? '' : 'none';
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            document.getElementById('dateFilter').value = 'all';
            document.getElementById('executorFilter').value = 'all';
            document.getElementById('typeFilter').value = 'all';
            applyFilters();
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            populateFilters();
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
        function toggleAllActive() {
            const selectAll = document.getElementById('selectAllActive');
            const checkboxes = document.querySelectorAll('.task-checkbox-active');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            updateActiveCount();
        }

        

        function updateActiveCount() {
            const checkboxes = document.querySelectorAll('.task-checkbox-active:checked');
            const count = checkboxes.length;
            const countSpan = document.getElementById('activeSelectedCount');
            
            if (count > 0) {
                countSpan.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${count}`;
                countSpan.style.color = '#28a745';
            } else {
                countSpan.textContent = '';
            }
        }

       

        function deleteSelectedActive() {
            const checkboxes = document.querySelectorAll('.task-checkbox-active:checked');
            const taskIds = Array.from(checkboxes).map(cb => cb.value);
            
            if (taskIds.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${taskIds.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á?`)) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                fetch('/delete_multiple_tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ task_ids: taskIds, type: 'active' })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + data.error);
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞: ' + error);
                });
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–µ–∫–±–æ–∫—Å–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥...
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('task-checkbox-active')) {
                    updateActiveCount();
                }
            });
        });

        
        
        </script>

</body>
</html>