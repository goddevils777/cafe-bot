<!DOCTYPE html>
<html>
<head>
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ñ–µ</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ username }}!</p>

    <h2>üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>
    {% if active_tasks %}
        <table border="1" style="border-collapse: collapse; width: 100%;">
           <tr>
                <th>–í—Ä–µ–º—è</th>
                <th>–ó–∞–¥–∞—á–∞</th>
                <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>
                <th>–¢–∏–ø</th>
                <th>–§–æ—Ç–æ-–æ—Ç—á—ë—Ç</th>
                <th>–°–æ–∑–¥–∞–Ω–æ</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            {% for task in active_tasks %}
            <tr>
                <td>{{ task[1] }}</td>
                <td>{{ task[2] }}</td>
                <td>{% if task[8] %}{{ task[8] }}{% else %}–î–ª—è –≤—Å–µ—Ö{% endif %}</td>
                <td>
                    {% if task[4] == 1 %}üîÑ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ
                    {% elif task[6] == 1 %}üìÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ ({{ ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'][task[7]] }})
                    {% else %}üìÖ –†–∞–∑–æ–≤–∞—è{% endif %}
                </td>
                <td>{% if task[5] == 1 %}üì∏ –î–∞{% else %}‚Äî{% endif %}</td>
                <td>{{ task[3] }}</td>
                <td>
                    <a href="/edit_task/{{ task[0] }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a> | 
                    <a href="/delete_task/{{ task[0] }}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</p>
    {% endif %}
    
    <h2>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–∑–æ–≤—ã–µ –∑–∞–¥–∞—á–∏</h2>
    {% if completed_tasks %}
        <table border="1" style="border-collapse: collapse; width: 100%;">
            <tr>
                <th>–í—Ä–µ–º—è</th>
                <th>–ó–∞–¥–∞—á–∞</th>
                <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>
                <th>–§–æ—Ç–æ-–æ—Ç—á—ë—Ç</th>
                <th>–°–æ–∑–¥–∞–Ω–æ</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            {% for task in completed_tasks %}
            <tr style="background-color: #f8f9fa;">
                <td>{{ task[1] }}</td>
                <td>{{ task[2] }}</td>
                <td>{% if task[8] %}{{ task[8] }}{% else %}–î–ª—è –≤—Å–µ—Ö{% endif %}</td>
                <td>{% if task[5] == 1 %}üì∏ –î–∞{% else %}‚Äî{% endif %}</td>
                <td>{{ task[3] }}</td>
                <td>
                    <a href="/restart_task/{{ task[0] }}">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</a> | 
                    <a href="/delete_task/{{ task[0] }}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–∑–æ–≤—ã—Ö –∑–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</p>
    {% endif %}
    
    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h2>
    <form action="/add_task" method="POST">
        <p>
            <label>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</label><br>
            <input type="time" name="task_time" required>
        </p>
        <p>
            <label>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:</label><br>
            <textarea name="task_text" rows="3" cols="50" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞—Å—Å—Ç–∞–≤–∏—Ç—å –∑–æ–Ω—Ç—ã" required></textarea>
        </p>
        <p>
            <label>–ù–∞–∑–Ω–∞—á–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label><br>
            <input type="text" name="assigned_to" id="assigned_to" placeholder="@username –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö" autocomplete="off">
            <div id="suggestions" style="display: none; position: absolute; background: white; border: 1px solid #ccc; max-height: 150px; overflow-y: auto; z-index: 1000;"></div>

            <script>
            const assignedInput = document.getElementById('assigned_to');
            const suggestionsDiv = document.getElementById('suggestions');
            const usernames = [
                {% if used_usernames %}
                    {% for nickname in used_usernames %}
                    "{{ nickname }}",
                    {% endfor %}
                {% endif %}
            ];

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –Ω–∏–∫–Ω–µ–π–º—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª–µ
            assignedInput.addEventListener('focus', function() {
                if (usernames.length > 0) {
                    suggestionsDiv.innerHTML = usernames.map(name => 
                        `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
                    ).join('');
                    suggestionsDiv.style.display = 'block';
                }
            });

            assignedInput.addEventListener('click', function() {
                if (usernames.length > 0) {
                    suggestionsDiv.innerHTML = usernames.map(name => 
                        `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
                    ).join('');
                    suggestionsDiv.style.display = 'block';
                }
            });

            assignedInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const filtered = usernames.filter(name => name.toLowerCase().includes(value));
                
                if (value.length > 0 && filtered.length > 0) {
                    suggestionsDiv.innerHTML = filtered.map(name => 
                        `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" onclick="selectUsername('${name}')">${name}</div>`
                    ).join('');
                    suggestionsDiv.style.display = 'block';
                } else {
                    suggestionsDiv.style.display = 'none';
                }
            });

            function selectUsername(name) {
                assignedInput.value = name;
                suggestionsDiv.style.display = 'none';
            }

            document.addEventListener('click', function(e) {
                if (!assignedInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });
            </script>
            <small style="color: #666;">üí° –£–∫–∞–∂–∏—Ç–µ @username –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ–π –∫–æ–º–∞–Ω–¥—ã</small>
        </p>
        <p>
            <label>–¢–∏–ø –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:</label><br>
            <input type="radio" name="repeat_type" value="once" checked> üìÖ –†–∞–∑–æ–≤–∞—è –∑–∞–¥–∞—á–∞<br>
            <input type="radio" name="repeat_type" value="daily"> üîÑ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ<br>
            <input type="radio" name="repeat_type" value="weekly"> üìÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
        </p>
        <p id="specific_date_select" style="display: block;">
            <label>–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–¥–ª—è —Ä–∞–∑–æ–≤—ã—Ö –∑–∞–¥–∞—á):</label><br>
            <input type="date" name="task_date" id="task_date">
            <small style="color: #666;">üí° –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è</small>
        </p>
        <p id="week_day_select" style="display: none;">
            <label>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:</label><br>
            <select name="week_day">
                <option value="0">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                <option value="1">–í—Ç–æ—Ä–Ω–∏–∫</option>
                <option value="2">–°—Ä–µ–¥–∞</option>
                <option value="3">–ß–µ—Ç–≤–µ—Ä–≥</option>
                <option value="4">–ü—è—Ç–Ω–∏—Ü–∞</option>
                <option value="5">–°—É–±–±–æ—Ç–∞</option>
                <option value="6">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
            </select>
        </p>
        <p>
            <label>
                <input type="checkbox" name="require_photo" value="1">
                üì∏ –¢—Ä–µ–±—É–µ—Ç —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç (—á–µ—Ä–µ–∑ 5 –º–∏–Ω –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
            </label>
        </p>
        <p>
            <input type="submit" value="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É">
        </p>
    </form>
    
    <script>
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
        document.querySelectorAll('input[name="repeat_type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const weekDaySelect = document.getElementById('week_day_select');
                const specificDateSelect = document.getElementById('specific_date_select');
                
                if (this.value === 'weekly') {
                    weekDaySelect.style.display = 'block';
                    specificDateSelect.style.display = 'none';
                } else if (this.value === 'once') {
                    weekDaySelect.style.display = 'none';
                    specificDateSelect.style.display = 'block';
                } else {
                    weekDaySelect.style.display = 'none';
                    specificDateSelect.style.display = 'none';
                }
            });
        });
    </script>
    
   <p>
        <a href="/reports">üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á—ë—Ç—ã</a> | 
        <a href="/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a> | 
        <a href="/logout">–í—ã–π—Ç–∏</a>
    </p>
</body>
</html>